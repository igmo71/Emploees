@page "/catalog_сотрудники_zup"
@using Emploees.Application
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components.QuickGrid
@using Emploees.Domain
@using Emploees.Data
@implements IAsyncDisposable
@inject IDbContextFactory<Emploees.Data.ApplicationDbContext> DbFactory
@inject IZupService ZupService

<PageTitle>Сотрудники ЗУП</PageTitle>

<h1>Сотрудники ЗУП (@(context.Catalog_Сотрудники_Zup.Count()))</h1>

<button class="btn btn-primary" type="button" @onclick="RefreshCatalog">Обновить данные из 1С ЗУП</button>

<QuickGrid Class="table" Items="context.Catalog_Сотрудники_Zup" @ref="catalogGrid">
	<PropertyColumn Property="item => item.Code" />
	<PropertyColumn Property="item => item.Description" />
	<PropertyColumn Property="item => item.DeletionMark" />
	<PropertyColumn Property="item => item.ВАрхиве" />
</QuickGrid>

@code {
	private QuickGrid<Catalog_Сотрудники_Zup>? catalogGrid;
	private ApplicationDbContext context = default!;

	protected override async Task OnInitializedAsync()
	{
		context = DbFactory.CreateDbContext();
	}

	private async Task RefreshCatalog(MouseEventArgs args)
	{
		await ZupService.RefreshCatalog();

		if (catalogGrid is not null)
			await catalogGrid.RefreshDataAsync();
	}


	public async ValueTask DisposeAsync() => await context.DisposeAsync();
}
